# image 문을 사용해 이미지를 정의합니다.
image door = im.Scale("images/door2.jpg", 1920, 1080)
image bright_light = im.Scale("images/bright_light.png", 1920, 1080)
image sea = im.Scale("images/sea.jpg", 1920, 1080) 
image letter = im.Scale("images/letter.png", 1500, 1080)

image tsukigake = im.Scale("images/tsukigake.png", 1500, 1080)
image building = im.Scale("images/building.png", 1500, 1080)

image scene0 = im.Scale("images/scenes/scene0.png", 1500, 1080)
image scene0_1 = im.Scale("images/scenes/scene0_1.png", 1500, 1080)
image scene0_2 = im.Scale("images/scenes/scene0_2.png", 1500, 1080)
image scene1 = im.Scale("images/scenes/scene1.png", 1500, 1080)
image scene2 = im.Scale("images/scenes/scene2.png", 1500, 1080)
image scene3 = im.Scale("images/scenes/scene3.png", 1500, 1080)
image scene4 = im.Scale("images/scenes/scene4.png", 1500, 1080)
image scene5 = im.Scale("images/scenes/scene5.png", 1500, 1080)
image scene6 = im.Scale("images/scenes/scene6.png", 1500, 1080)
image scene7 = im.Scale("images/scenes/scene7.png", 1500, 1080)
image scene8 = im.Scale("images/scenes/scene8.png", 1500, 1080)
image scene9 = im.Scale("images/scenes/scene9.png", 1500, 1080)
image scene10 = im.Scale("images/scenes/scene10.png", 1500, 1080)

image scene11 = im.Scale("images/scenes/scene11.png", 1500, 1080)
image scene11_1 = im.Scale("images/scenes/scene11_1.png", 1500, 1080)
image scene12 = im.Scale("images/scenes/scene12.png", 1500, 1080)
image scene13 = im.Scale("images/scenes/scene13.png", 1500, 1080)
image scene14 = im.Scale("images/scenes/scene14.png", 1500, 1080)
image scene15 = im.Scale("images/scenes/scene15.png", 1500, 1080)
image scene16 = im.Scale("images/scenes/scene16.png", 1500, 1080)
image scene17 = im.Scale("images/scenes/scene17.png", 1500, 1080)
image scene18 = im.Scale("images/scenes/scene18.png", 1500, 4499 * 1500 // 3402)
image scene19 = im.Scale("images/scenes/scene19.png", 1500, 1080)
image scene20 = im.Scale("images/scenes/scene20.png", 1500, 1080)


image scene21 = im.Scale("images/scenes/scene21.png", 1500, 1080)
image scene22 = im.Scale("images/scenes/scene22.png", 1500, 1080)
image scene23 = im.Scale("images/scenes/scene23.png", 1500, 1080)
image scene24 = im.Scale("images/scenes/scene24.png", 1500, 1080)
image scene25 = im.Scale("images/scenes/scene25.png", 1500, 1080)
image scene26 = im.Scale("images/scenes/scene26.png", 1500, 1080)
image scene26_1 = im.Scale("images/scenes/scene26_1.png", 1500, 1080)
image scene27 = im.Scale("images/scenes/scene27.png", 1500, 1080)
image scene28 = im.Scale("images/scenes/scene28.png", 1500, 1080)
image scene29 = im.Scale("images/scenes/scene29.png", 1500, 1080)
image scene30 = im.Scale("images/scenes/scene30.png", 1500, 1080)

image scene31 = im.Scale("images/scenes/scene31.png", 1500, 1080)
image scene32 = im.Scale("images/scenes/scene32.png", 1500, 1080)
image scene33 = im.Scale("images/scenes/scene33.png", 1500, 1080)
image scene34 = im.Scale("images/scenes/scene34.png", 1500, 1080)
image scene35 = im.Scale("images/scenes/scene35.png", 1500, 1080)
image scene36 = im.Scale("images/scenes/scene36.png", 1500, 1080)
image scene37 = im.Scale("images/scenes/scene37.png", 1500, 1080)
image scene38 = im.Scale("images/scenes/scene38.png", 1500, 1080)
image scene39 = im.Scale("images/scenes/scene39.png", 1500, 1080)
image scene40 = im.Scale("images/scenes/scene40.png", 1500, 1080)

image scene41 = im.Scale("images/scenes/scene41.png", 1500, 1080)
image scene42 = im.Scale("images/scenes/scene42.png", 1500, 1080)
image scene42_1 = im.Scale("images/scenes/scene42_1.png", 1500, 1080)
image scene43 = im.Scale("images/scenes/scene43.png", 1500, 1080)
image scene44 = im.Scale("images/scenes/scene44.png", 1500, 1080)
image scene45 = im.Scale("images/scenes/scene45.png", 1500, 1080)
image scene46 = im.Scale("images/scenes/scene46.png", 1500, 1080)
image scene47 = im.Scale("images/scenes/scene47.png", 1500, 1080)
image scene48 = im.Scale("images/scenes/scene48.png", 1500, 1080)
image scene49 = im.Scale("images/scenes/scene49.png", 1500, 1080)
image scene50 = im.Scale("images/scenes/scene50.png", 1500, 1080)

image scene51 = im.Scale("images/scenes/scene51.png", 1500, 4603 * 1500 // 3406)
image scene52 = im.Scale("images/scenes/scene52.png", 1500, 1080)
image scene53 = im.Scale("images/scenes/scene53.png", 1500, 5383 * 1500 // 3423)
image scene54 = im.Scale("images/scenes/scene54.png", 1500, 1080)
image scene55 = im.Scale("images/scenes/scene55.png", 1500, 1080)
image scene56 = im.Scale("images/scenes/scene56.png", 1500, 1080)
image scene57 = im.Scale("images/scenes/scene57.png", 1500, 1080)
image scene58 = im.Scale("images/scenes/scene58.png", 1500, 1080)
image scene59 = im.Scale("images/scenes/scene59.png", 1500, 1080)
image scene60 = im.Scale("images/scenes/scene60.png", 1500, 1080)
image scene60_1 = im.Scale("images/scenes/scene60_1.png", 1500, 1080)

image scene61 = im.Scale("images/scenes/scene61.png", 1500, 1080)
image scene62 = im.Scale("images/scenes/scene62.png", 1500, 1080)
image scene63 = im.Scale("images/scenes/scene63.png", 1500, 1080)
image scene64 = im.Scale("images/scenes/scene64.png", 1500, 1080)
image scene65 = im.Scale("images/scenes/scene65.png", 1500, 1080)
image scene66 = im.Scale("images/scenes/scene66.png", 1500, 1080)
image scene67 = im.Scale("images/scenes/scene67.png", 1500, 1080)
image scene68 = im.Scale("images/scenes/scene68.png", 1500, 1080)
image scene69 = im.Scale("images/scenes/scene69.png", 1500, 1080)
image scene69_1 = im.Scale("images/scenes/scene69_1.png", 1500, 1080)
image scene70 = im.Scale("images/scenes/scene70.png", 1500, 1080)

image scene71 = im.Scale("images/scenes/scene71.png", 1500, 4498 * 1500 // 3396)
image scene72 = im.Scale("images/scenes/scene72.png", 1500, 1080)
image scene73 = im.Scale("images/scenes/scene73.png", 1500, 1080)
image scene74 = im.Scale("images/scenes/scene74.png", 1500, 1080)
image scene75 = im.Scale("images/scenes/scene75.png", 1500, 1080)
image scene76 = im.Scale("images/scenes/scene76.png", 1500, 1080)
image scene77 = im.Scale("images/scenes/scene77.png", 1500, 1080)
image scene78 = im.Scale("images/scenes/scene78.png", 1500, 1080)
image scene79 = im.Scale("images/scenes/scene79.png", 1500, 1080)
image scene80 = im.Scale("images/scenes/scene80.png", 1500, 1080)

image scene81 = im.Scale("images/scenes/scene81.png", 1500, 1080)
image scene82 = im.Scale("images/scenes/scene82.png", 1500, 1080)
image scene83 = im.Scale("images/scenes/scene83.png", 1500, 1080)
image scene84 = im.Scale("images/scenes/scene84.png", 1500, 1080)
image scene85 = im.Scale("images/scenes/scene85.png", 1500, 1080)
image scene86 = im.Scale("images/scenes/scene86.png", 1500, 1080)
image scene87 = im.Scale("images/scenes/scene87.png", 1500, 1080)
image scene88 = im.Scale("images/scenes/scene88.png", 1500, 1080)
image scene89 = im.Scale("images/scenes/scene89.png", 1500, 1080)
image scene90 = im.Scale("images/scenes/scene90.png", 1500, 1080)

image scene91 = im.Scale("images/scenes/scene91.png", 1500, 1080)
image scene92 = im.Scale("images/scenes/scene92.png", 1500, 1080)
image scene93 = im.Scale("images/scenes/scene93.png", 1500, 1080)
image scene94 = im.Scale("images/scenes/scene94.png", 1500, 1080)
image scene95 = im.Scale("images/scenes/scene95.png", 1500, 1080)
image scene96 = im.Scale("images/scenes/scene96.png", 1500, 1080)
image scene97 = im.Scale("images/scenes/scene97.png", 1500, 1080)
image scene98 = im.Scale("images/scenes/scene98.png", 1500, 1080)
image scene99 = im.Scale("images/scenes/scene99.png", 1500, 1080)
image scene100 = im.Scale("images/scenes/scene100.png", 1500, 1080)

image scene101 = im.Scale("images/scenes/scene101.png", 1500, 1080)
image scene102 = im.Scale("images/scenes/scene102.png", 1500, 1080)
image scene103 = im.Scale("images/scenes/scene103.png", 1500, 1080)
image scene104 = im.Scale("images/scenes/scene104.png", 1500, 1080)
image scene105 = im.Scale("images/scenes/scene105.png", 1500, 1080)
image scene106 = im.Scale("images/scenes/scene106.png", 6489 * 1080 // 2475, 1080)

image character_kogoro = im.Scale("images/character_kogoro01.png", 586*1.5, 426*1.5)
image character_ran = im.Scale("images/character_ran.png", 207*2.5, 243*2.5)

# # 게임에서 사용할 캐릭터를 정의합니다.
# define character_conan = Character('에도가와 코난', color="#c8ffc8")
# define character_ran = Character('모리 란', color="#c8ffc8")
# define character_kogoro = Character('모리 코고로', color="#c8ffc8")
define character_narumi = Character('주민', color="#c8ffc8")
# define character_simizu = Character('시미즈 마사토', color="#c8ffc8")

# define employee = Character('직원', color="#c8ffc8")
# define chief = Character('주임', color="#c8ffc8")
# define people = Character('주민', color="#c8ffc8")
# define idonknow = Character('???', color="#c8ffc8")

# 분기 관련 변수
default knows_narumi = 0 # 0: 바로간다 / 1: 물어보고 간다 / 2: 물어보고 촌장 후보 알고 간다 / 3: 이름, 의사, 전 촌장 제사일
default knows_door_behind = 0 # 0: 모른다 / 1: 바다 임을 알고 있다.
default conan_piano = 0 # 0: 피아노 안침 / 1: 피아노 쳐서 조율 된 것 예측 가능

default find1 = False # 바닷물
default find2 = False # 바깥에 웃 옷
default find3 = False # 시체 등에 진흙, 모래
default find4 = False # 녹음 테이프 앞 부분이 공백
default find5 = False # 문 다 잠겨 있음

label conan_start:
    scene black
    
    m "영화관 문이 굉장히 독특하네.."

    scene door with fade

    "문에는 정교한 무늬와 황금빛 손잡이가 있었고, 묘한 분위기가 감돌았다."
    "호기심에 문을 열어보았다."

    play sound "door_open.ogg"
    scene bright_light with dissolve

    "문을 여는 순간 강렬한 빛이 나를 휘감았다."

    play sound "boat_horn.ogg"
    scene sea with fade

    "눈을 뜨니, 배 안이었다."
    "눈 앞에는 파도가 일렁이는 바다가 보였다."

    play sound "sea_sound.ogg"
    scene black
    show scene0 with fade
    "옆자리에서는 두 명의 왠지 익숙한 인물이 대화를 나누고 있었다."

    character_kogoro "나원 참.."
    character_kogoro "사람들은 다 벚꽃놀이 하러 간다는데"
    character_kogoro "어째서 이 명탐정 모리 코고로는"
    character_kogoro "그런 섬으로 나가야 하냔 말야~"
    character_kogoro "일주일 전 도착한 그런 편지 때문에 말야~!"
    character_kogoro "나참, 자기 멋대로인 의뢰인이라니까~"

    show scene0_1 with fade
    character_ran "좋잖아요. 어느 작은 섬에서 한가하게 보낼 수 있으니까요."
    character_ran "그치  코난 군?"

    character_conan "에...? 설마... 나보고 하는 말인가?"
    "나는 얼떨결에 고개를 끄덕였지만, 속으로는 심장이 요동쳤다."
    character_conan "(뭐지, 이 상황은? 나는 영화를 보러 갔던 것 같은데... 여기, 이 배는 뭐야?)"

    "눈앞에 보이는 코고로 아저씨와 유미란. 내가 아는 인물들이었지만, 동시에 낯설었다."
    "그들의 대화는 너무 자연스러웠고, 내가 끼어든 느낌은 전혀 없었다."

    character_conan "에...? 내가 코난이 된 거야?"
    "손을 들어 얼굴을 만져보니, 낯익은 얼굴의 감각이 느껴졌다. 그리고 목소리... 이건 분명 코난의 목소리다."

    character_conan "(이건 꿈일까? 아니면... 현실인가?)"
    "혼란스러운 감정이 밀려왔지만, 지금은 그걸 생각할 때가 아니었다."

    menu:
        "상황을 받아들이고 침착하려고 한다":
            "일단 내가 어디에 있는지, 그리고 이 상황이 어떻게 흘러갈지 파악해야 했다."
            jump accept_situation

        "이게 현실인지 꿈인지 확인하려고 한다":
            "이건 너무 말도 안 되는 일이었다. 어떻게 하면 원래 세계로 돌아갈 수 있을까?"
            jump check_reality

label accept_situation:
    character_conan "(지금은 패닉에 빠질 때가 아니야. 이 상황에서 내가 해야 할 일을 찾아야 해.)"
    "코난의 모습으로 행동하기로 결심했다."
    jump mystery_introduction

label check_reality:
    character_conan "(말도 안 돼... 내가 코난이라고? 이건 말 그대로 꿈이어야 해!)"
    "내 손을 꼬집어보았다. 하지만 고통이 선명하게 느껴졌다."
    character_conan "(현실... 이건 현실이야. 그럼, 어떻게 해야 원래대로 돌아갈 수 있지?)"
    character_conan "(설마 사건을 해결해야지 현실로 돌아갈 수 있는 건가..?)"
    jump mystery_introduction

label mystery_introduction:
    character_ran "코난 군? 무슨 생각해? 상태는 괜찮아?"
    character_conan "아, 응. 괜찮아. 근데... 저 편지에 대해 좀 더 알려줄 수 있어?"
    
    character_ran "편지에는 이렇게 적혀 있었어."
    show letter with fade
    character_ran "다음 만월의 밤, {color=#ff4500}츠키카게 섬{/color}에서 다시 그림자가 사라지기 시작할 거요. 조사해주시길...\n - {color=#ff4500}아소 케이지{/color}"

    character_conan "({color=#ff4500}츠키카게 섬{/color}...? 그리고 {color=#ff4500}아소 케이지{/color}...? 뭔가 익숙한 느낌인데...)"
    "나는 머릿속에서 이 이름들을 되새기며 상황을 정리하려고 애썼다."
    
    show scene0_2 with fade
    character_ran "코난 군? 무슨 일있어?"
    character_conan "아, 아니야. 그냥 편지 내용이 궁금해서 그런거야."
    
    "일단 상황을 파악하며 {color=#ff4500}츠키카게 섬{/color}으로 향하기로 했다."
    scene black
    show tsukigake with fade
    "츠키카게 섬"

    jump building_introduction

label building_introduction:
    stop sound
    scene black
    show building with fade
    "츠키카게 섬 사무소"

    show scene1 with fade
    employee "어떻게 오셨을까요?"

    character_kogoro "아, 그게... 의뢰 때문에 왔는데..."
    employee "의뢰요? 어떤 분이 의뢰를 보내셨죠?"

    character_kogoro "의뢰인이... 음... 그게 누구더라... 갑자기 이름이 기억이 안나네"
    character_conan "의뢰인은 이분이에요!"

    menu:
        "아소 카이토":
            character_conan "(카이토는 괴도키드 아니야?)"
            "사건에 집중하자."
            jump building_introduction

        "아소 케이지":
            character_conan "의뢰인은 아소 케이지에요. 이 편지를 보낸 사람이죠."
            character_kogoro "맞아 그런 이름이였어!"
            employee "아, 그렇군요. 찾아보겠습니다."
            jump ask_about_letter

        "아키라 케이지":
            character_conan "(아키라 만화 너무 많이 본거 아니야?)"
            "더 생각해보자."
            jump building_introduction

label ask_about_letter:
    employee "아소.. 케이..지.."
    employee "없는데요~, 그런 이름을 가진 사람은.."
    character_kogoro "좀 더 잘 찾아보세요."
    character_kogoro "보시다시피 지난 주에 그 사람한테서 편지가.."
    employee "하지만 주민 명부에도 올라있지 않고"
    employee "저도 이 섬에 이제 막 와서 자세한 건.."

    show scene2
    chief "무슨 일인가?"
    employee "아, 주임님"
    employee "이분들이 섬 주민에게 의뢰를 받고 오셨답니다."

    show scene3
    chief "의뢰?"
    employee "네. 아소 케이지 씨란 분에게.."

    show scene4
    chief "뭐..?" # 놀란 얼굴

    play sound "shock.ogg"
    show scene5
    chief "뭐..? 아, 아소 케이지라고?!?!?!" # 놀란 얼굴
    show scene6
    ""
    show scene7
    ""
    show scene8
    ""
    show scene9
    ""
    show scene10
    chief "그그, 그럴 수는 없어!"
    chief "왜왜, 왜냐면 그 사람은"
    chief "10년도 더 전에.. {color=#ff4500}죽었으니까!{/color}"

    show scene11

    jump asokeigi_introduction

label asokeigi_introduction:
    play sound "moon_light.ogg"
    show scene11_1
    ""
    show scene12
    chief "그 사람은 이 섬 출신으로.."

    show scene13
    chief "유명한 피아니스트였죠."

    show scene14
    chief "12년 전, 만월의 밤이었습니다."
    chief "오랜만에 왔던 그 사람은"
    chief "마을의 구민 회관에서 연주회를 가졌거든요."

    show scene15
    chief "그런데 그 후에 갑자기 가족과 집에 틀어박혀서는"
    chief "불을 질렀습니다."

    show scene16
    chief "그 사람은 아내와 딸을 칼로 살해하고"

    show scene17
    chief "타오르는 불길 속에서 뭐에 홀린 듯이 피아노를 계속 연주했다고 합니다."

    show scene18:
        xalign 0.5 yalign 0.5
        linear 5 ypos 1983-1080
    pause 5
    chief "베토벤의 피아노 소나타.."
    chief "{color=#ff4500}『월광』{/color}을.."

    stop sound fadeout 1.0

    jump story1

label story1:
    scene black
    show scene19 with fade
    character_kogoro "흠.. 죽은 사람한테서 온 편지라니.."
    character_kogoro "질 나쁜 장난이구먼!"
    character_conan "그런 것 같진 않아요."
    character_conan "왜냐면 의뢰비는 분명히 들어왔고"
    character_conan "편지의 소인도 이 츠키카게 섬으로 되어 있어요."
    character_conan "분명히 섬의 어떤 사람이 아저씨가"
    character_conan "그 아소 케이지를 조사해주길 바라는걸 거에요."

    show scene20
    character_ran "아 그래요!"
    character_ran "아소 씨의 친구라고 했던"
    character_ran "이 섬의 {color=#ff4500}촌장{/color}님께 물어보면 뭘 좀 알 수 있을지도 몰라요."
    character_kogoro "그렇군."
    character_kogoro "분명히 촌장은 구민 회관에 있다고 그랬었지?"

    menu:
        "주민에게 구민회관 가는 길을 물어본다":
            jump additional_conversations

        "바로 간다":
            character_conan "구민 회관으로 바로 가죠!"
            jump guess_location
    
label guess_location:
    character_ran "코난, 구민 회관이 어디있는 지 알고 가는거니?"

    menu:
        "눈 앞에 있잖아요!":
            character_kogoro "눈 앞에는 병원말고 보이지 않는걸..?"
            jump ask_resident

        "병원 옆 길 따라가면 나올거에요!":
            character_conan "병원 옆 길 따라가면 나올거에요!"
            character_ran "역시 코난, 얼른 가보자!"
            jump to_chief

label ask_resident:
    character_conan "아 착각했나봐요. 주민에게 물어보는게 빠를 거 같아요."
    jump additional_conversations

label additional_conversations:
    $ knows_narumi = 1
    show scene21 with fade
    character_ran "저 실례합니다."

    show scene22
    character_ran "구민 회관이 어디에요?"

    show scene23
    character_narumi "아 저 끝의 모퉁이를 돌아가면"
    character_narumi "곧바로 있는 막다른 곳에 있어요."

    menu:
        "주민과 이야기를 더 해본다.":
            jump additional_conversations_2

        "바로 간다.":
            $ character_narumi = Character("길 알려준 주민")  # 이름을 업데이트
            jump to_chief


label additional_conversations_2:
    $ knows_narumi = 2
    character_narumi "아, 혹시 여러분, 도쿄에서 오셨어요?"

    show scene24
    character_ran "네. 좀 전에 있던 배로.."

    show scene26_1
    character_narumi "에~~? 저희 집도 도쿄에 있어요!"
    character_narumi "하지만 이 섬도 도쿄와는 다르게 멋있죠?"
    show scene26
    character_narumi "공기도 맑고~!, 얼마나 조용한지~!"

    show scene25
    "촌장 선거 홍보차가 지나간다."
    show scene27
    "시미즈! 시미즈! 시미즈 마사토!! 섬의 어장을 지키기 위해~~~"

    show scene28
    character_narumi "그건 아닌가..?"
    character_narumi "이제 곧 촌장 선거가 있거든요."
    character_kogoro "오.. 촌장 선거.."

    show scene29 with fade
    character_narumi "후보자는 방금 지나간 구민 대표, 시미즈 씨"

    show scene30 with fade
    character_narumi "요즘 평가가 떨어지고 있는 현재 촌장인 쿠로이와 씨"

    show scene31 with fade
    character_narumi "그리고 섬 제일의 재산가, 가와시마 씨."

    show scene32
    character_narumi "환자 분들의 얘기로는 가와씨마 씨가.."

    show scene33
    character_kogoro "아, 아뇨, 간호사 선생.."
    character_kogoro "우리는 촌장 선거엔 흥미가 없거든요."

    menu:
        "주민과 더 이야기를 해본다.":
            jump additional_conversations_3

        "바로 간다.":
            $ character_narumi = Character("길 알려준 간호사 선생")  # 이름을 업데이트
            character_conan "그럼 이만 저희는 급한 일때문에 가볼게요!!"
            character_ran "실례했습니다"
            jump to_chief

label additional_conversations_3:
    $ knows_narumi = 3

    show scene34
    $ character_narumi = Character("아사이 나루미")  # 이름을 업데이트
    character_narumi "전 의사인 아사이 나루미에요."
    character_narumi "분명히 의사 면허증도 갖고 있어요."

    character_kogoro "아, 의사선생님이셨나요?"
    character_narumi "여러분, 구민 회관에 가실거라면"
    character_narumi "지금 말한 세 사람과도 만날걸요."

    show scene35 with fade
    character_narumi "오늘 밤에 거기서 전 촌장인"
    character_narumi "가게야마 씨의 삼 주기 제사가 있거든요."

    jump to_chief

label to_chief:
    scene black
    show scene36 with fade
    "구민 회관"
    
    show scene37
    people "현 촌장의 횡포를 용서 못 한다!!"
    "촌장 선거 기간이라 시끌벅적하다."

    show scene38
    character_kogoro "나원 참~"
    character_kogoro "언제까지 기다리게 할 작정이야~!"

    menu:
        "기다리는 동안 혼자 조사해본다.":
            jump solo_find
        
        "같이 다닌다.":
            jump story2

label solo_find:
    show scene39
    character_ran "에? 코난 군은요?"
    
    play sound "wooden_door_open.ogg"
    show scene40
    ""

    show scene41 with fade
    character_conan "피아노구나."

    show scene42
    character_ran "아, 얘, 코난 군, 안돼!"
    character_kogoro "어~~, 뭐냐?"

    jump story2

label story2:
    show scene42_1
    character_kogoro "진짜 큰 방이구먼~~"

    scene black
    show scene41
    menu:
        "피아노 뒷 문을 조사해본다.":
            $ knows_door_behind = 1 
            show scene46
            play sound "sea_sound.ogg"
            character_conan "오~ 구민 회관 뒤편은 바로 바다구나.."
            stop sound
        "피아노를 조사해본다.":
            pass
    
    show scene43
    character_ran "이 피아노, 지저분하다~"
    character_ran "조금이라도 청소했으면 좋았을걸~"

    show scene44
    employee "아, 안 됩니다! 만지면!!"

    show scene45
    employee "그 피아노는.."
    employee "아소 씨가 죽던 날 연주회에서 연주했던"
    employee "저주 받은 피아노..!"

    show scene47
    character_kogoro "그럴리가요. 저주 받았다니.."

    show scene48
    employee "아소 씨만이 아니에요!"
    employee "전 촌장님도 같은 일을..!"

    show scene49
    if knows_narumi == 3:
        character_kogoro "전 촌장이라면.."
        character_kogoro "오늘 제사를 지낸다는.."
        character_kogoro "가게야마 이사무 씨?"
    else:
        character_kogoro "전 촌장님한테 무슨 일이 있었나요?"

    show scene50
    employee "네.."
    employee "그건 2년 전에 일어난 일입니다."

    play sound "moon_light.ogg"
    show scene51 at Position(yanchor=0.0, xalign=0.5, ypos=1.0):
        linear 8 ypos -0.9
    pause 2
    employee "만월의 밤이었습니다."
    pause 2
    employee "우연히 근처를 지나가던 저는"
    pause 2
    employee "아무도 없는 구민 회관 안에서 나는 피아노 소리를 들었습니다."
    pause 2


    show scene52
    employee "누구 있는 거냐고 물었더니"
    employee "소리가 뚝 끊겼고.."
    stop sound
    play sound "wooden_door_open.ogg"
    employee "안에 들어갔더니 거기엔.."

    play sound "shock.ogg"
    show scene53 at Position(yanchor=0.6, xalign=0.5, ypos=1):
        linear 8 ypos 1.3
    employee "전 촌장님인 가게야마 씨가..!"
    employee "사인은 심장마비였습니다."
    employee "그리고 그가 죽기 직전까지 연주하고 있던 곡도.."

    show scene18:
        xalign 0.5 yalign 0.5
        linear 2 ypos 1983-1080
    employee "아소 씨가 불길 속에서 계속 연주했던"

    show scene55
    employee "그 『월광』 이었습니다."

    show scene56 with fade
    employee "그 이후 이 피아노는"
    employee "언제부턴가 저주 받은 피아노로 불리게 됐죠.."

    menu:
        "피아노 쳐보기":
            $ conan_piano = 1
            play sound "cat_dance.ogg"
            show scene57
            employee "으앗"
            character_ran "코난 군, 그러면 안돼!"
            character_conan "별로 아무렇지도 않은데? 이 피아노."

        "이방에서 나가기":
            pass

    play sound "close_door.ogg"
    show scene58
    employee "어쨌거나 전 촌장님 제사가 끝날 때까지 현관에서 기다려 주세요!"
    
    if knows_narumi == 3:
        pass
    else:
        "하필 오늘이 전 촌장님 제사일인 모양이네.."

    if knows_narumi == 0:
        show scene59
        character_narumi "안녕하세요. 처음 뵙겠어요."

        show scene60_1
        character_ran "어, 안녕하세요. 혹시 어디서 보지 않았나요 저희...?"

        character_narumi "아, 혹시 도쿄에서 오셨다는 분들인가요?"
        character_ran "네, 맞아요. 배로 방금 이 섬에 도착했어요."

        $ character_narumi = Character("아사이 나루미")  # 이름을 업데이트
        character_narumi "저는 아사이 나루미라고 해요. 이 섬의 의사입니다."

        character_narumi "도쿄에서 오셨다니 반갑네요. 저도 도쿄에서 살다가 이 섬으로 왔거든요."
        character_ran "그렇군요. 이 섬에서도 의사로 활동하고 계시는군요."

        character_narumi "네, 이 섬에서 몇 년째 진료하고 있죠."
        character_narumi "근데 여기서 뭘 기다리고 계신 거에요?"
        character_conan "들어보니 오늘 전 촌장님의 제사가 있다고 하더라고요."
        character_narumi "네. 저도 제사 때문에 들렀어요. 가메야마 씨라면 제가 이 섬에서 처음 검시한 분이거든요."
        character_narumi "그래서 향이라도.."

    elif knows_narumi == 1 or knows_narumi == 2:
        show scene59
        character_narumi "어머, 여러분, 아직 계셨군요?"
        character_ran "아, 덕분에 길 알려주셔서 잘 찾아왔어요! 여기서 또 뵙네요."
        character_narumi "네. 제사 때문에 들렀어요. 가메야마 씨를 기억하는 분들이 많더라고요."
        character_conan "가메야마 씨라면...?"
        character_narumi "제가 이 섬에서 처음 검시한 전 촌장님이에요."
        character_narumi "그래서 향이라도.."
        character_kogoro "아, 실례했습니다. 의사선생님인줄 몰라 봤네요."
        character_narumi "괜찮아요. 다들 그렇게 오해들 하시는걸요"
        $ character_narumi = Character("아사이 나루미", color="#CBAFDD")  # 이름을 업데이트
        character_narumi "정식으로 인사드릴게요. 저는 아사이 나루미. 전에 봤던 병원에서 의사로 있답니다."

    else:
        show scene59
        character_narumi "어머, 여러분, 아직 계셨어요?"

        show scene60_1
        character_ran "나루미 씨!"
        character_ran "제사에 오신 거에요?"

        character_narumi "네. 제가 이 섬에 와서 처음 검시한 사람이 가메야마 씨였어요."
        character_narumi "그래서 향이라도.."

    show scene60
    character_narumi "아, 이 쪽은 시미즈 씨에요!"
    character_narumi "아까 병원 쪽에서 만나서 같이 왔어요."

    show scene61
    character_simizu "처음 뵙겠습니다. 시미즈 입니다. 반갑습니다."

    show scene62 with fade
    "구민회관 현관"
    character_conan "뭔가 이상해.."
    # 피아노를 쳤을 때 나올것.

    if conan_piano == 1:
        show scene63
        character_conan "저 피아노.. 몇 년 동안 치지 않았을 텐데"
        character_conan "소리가 정확하게 났어."
        character_conan "아마 누군가가 몰래 조율해 놓은 걸 거야."
        character_conan "어떤 목적으로.. "

        show letter # 편지내용
        character_conan "그리고 그 편지 내용이 의미하는건 대체.."
    
    else:
        show letter # 편지내용
        character_conan "그럼 편지 내용이 의미하는건 대체.."

    show scene65 # 달
    play music "moon_light.ogg"
    "어디선가 월광 노래가 흘러 나온다."

    show scene66
    character_ran "아, 이곡은..!"

    show scene67
    character_conan "월광!?"

    play sound "run.ogg"
    show scene68
    character_conan "큰일났다!!"
    character_ran "코난 군!"

    show scene69
    people "어이 꼬마야!"

    play sound "close_door.ogg"
    show scene69_1
    ""

    show scene70
    "(술렁술렁)"

    show scene71 at Position(yanchor=0.5, xalign=0.5, ypos=1):
        linear 8 ypos 0.90
    character_kogoro "가와시마 씨가..!"

    show scene72
    character_conan "(늦었어..!)"

    show scene73
    character_kogoro "이미 죽었오."

    show scene74
    people "뭐, 뭐라고..?"

    show scene75
    character_kogoro "란, 어서 빨리 파출소에 연락해라."
    character_ran "네!"
    character_kogoro "나루미 선생님, 검시를 부탁합니다."
    character_narumi "아, 네"

    show scene76
    character_conan "(그렇군!)"
    character_conan "(그 편지는 만월의 밤, 다시 이 츠키카게 섬에서)"
    character_conan "(사람이 죽을 거란 걸 예고하는 거였어!)"

    show scene77
    employee "저, 저주다~~!"

    show scene78
    employee "이건.. 저 피아노의 저주야~~!!"

    show scene79
    character_kogoro "흥, 뭐가 저주란 거요~"

    show scene80
    character_kogoro "소리를 내고 있는 건"
    character_kogoro "이 테이프의 레코더요."
    stop music

    show scene81
    character_kogoro "이건 전에 일어났던 두 개의 사건을 흉내내서"
    character_kogoro "꾸며진 살인 사건이란 말이오!"

    show scene82
    employee "사, 살인?"

    show scene83
    people "이봐요, 이봐! 말도 안 되는 소리 하지 말아요!"
    people "도대체 당신, 누구요!"

    show scene84
    character_kogoro "난 도쿄에서 온 명탐정.."
    character_kogoro "모리 코고로입니다."

    show scene85
    people "그게 누구야??"
    people "나도 처음 듣는데.."

    character_conan "(이 사람.. 그렇게 유명한 탐정은 아닌가..?)"
    character_conan "(해결할 수 있게 내가 도와서 사건의 힌트를 줘야겠어!)"
    
    # 조사하기
    # 바닷물, 바깥에 웃옷 떠다님, 등에 진흙 모래 자갈, 문 방창문 다 잠겨잇음, 녹음 테이프 앞 부분이 공백으로 되어있음
    # 현관엔 우리가 계속 있었으니까 범인은 이안에!
    scene black
    jump mystery1

label mystery1_finish:
    $ main_done = sum(1 for v in investigation_state.values() if v)

    stop music
    stop sound
    scene black
    show scene95
    character_narumi "사망 추정 시각은 30분에서 1시간 전."
    character_narumi "사인은 질식사겠죠."

    # 사망 원인 추리
    "가와시마 씨의 사인은 무엇이지?"
    menu:
        "익사했다.":
            pass
        "둔기에 의해 사망했다.":
            character_conan "둔기에 의한 사망했다는 증거가 전혀 없어.."
            jump mystery1_finish
        "과로사이다.":
            character_conan "과로사했을 수도 있지만, 증거가 전혀 없어.."
            jump mystery1_finish
        "심장마비에 의해 사망했다.":
            character_conan "심장마비에 의해 사망했다는 증거가 전혀 없어.."
            jump mystery1_finish
        "자살이다.":
            character_conan "자살했다는 증거가 전혀 없어.."
            jump mystery1_finish
    
    show scene96
    character_narumi "아마도 가와시마 씨는"
    character_narumi "익사한 것 같아요."
    character_kogoro "물에 빠뜨린 건가.."
    character_narumi "해부해보기 전엔 단정할 수 없지만.."

    # 익사 장소 추리
    "가와시마 씨는 어디에서 익사했을까?"
    menu:
            "강":
                character_conan "이 주변에는 강이 없어..!"
                jump mystery1_finish
            "바다":
                pass
            "저수지":
                character_conan "이 주변에는 저수지는 없어..!"
                jump mystery1_finish
            "목욕탕":
                character_conan "목욕탕이 진정 맞을까..?"
                jump mystery1_finish

    show scene97
    character_conan "나루미 선생님 말이 맞는 것 같아요."

    # 코난 추리
    if choice_state["window_2"]:
        scene black
        show scene87
        character_conan "보세요, 밖의 바닷가에 웃옷이.."
        character_conan "분명히 저거 가와시마 씨 옷일 거에요."
    
    if investigation_state["water"]:
        scene black
        show scene88
        character_conan "바다로 이어지는 이 문에서 피아노 근처까지 끌린 자국이 있고.."

    if investigation_state["person"]: 
        scene black 
        show scene88
        character_conan "가와시마 씨의 등에는 진흙과 모래가 묻어 있어요."
    
    if choice_state["door_1"] and choice_state["window_1"]:
        scene black
        show scene92
        character_conan "그리고 이 문과 방 창문은 모두 잠겨 있고,"
    
    if investigation_state["radio"]:
        scene black
        show scene93
        character_conan "녹음 테이프의 앞 부분이 몇 분간 공백으로 되어 있는 점으로 봐서.."

    # 다 조사 했을 경우
    if main_done == 5 and choice_state["door_1"] and choice_state["window_1"] and choice_state["window_2"]:
        show scene98
        character_kogoro "이, 이 녀석이 언제.."
        
        show scene99
        character_conan "아마도 범인은"

        show scene100
        character_conan "제사 도중에 가와시마 씨를 바다로 데리고 가 익사시켜서"

        show scene101
        character_conan "시체를 이 방으로 옮긴 뒤"

        show scene102
        character_conan "문을 잠그고 테이프 레코더의 스위치를 누른 뒤 복도로 나갔다.."

        show scene103
        character_conan "그렇죠? 아저씨!"
        character_kogoro "아! 그래! 그렇지!!"

        show scene104
        character_kogoro "이 방 문이 잠겨 있었다면"

        show scene62
        character_kogoro "현관에는 계~속 우리가 있었으니"
        character_kogoro "범인은 제사 드리는 곳으로 돌아갔을 가능성이 높아."


    # 모리 코고로 추가 추리
    else:
        scene black
        show scene104
        character_kogoro "그리고 추가적으로 얘기를 하면"
        if choice_state["window_2"] == False: 
            scene black
            show scene87
            character_kogoro "밖의 바닷가에 웃옷이 있습니다."
            character_kogoro "분명히 저거 가와시마 씨 옷이겠지요."
        
        if investigation_state["water"] == False: 
            scene black
            show scene88
            character_kogoro "바다로 이어지는 이 문에서 피아노 근처까지 끌린 자국이 있고.."

        if investigation_state["person"] == False: 
            scene black
            show scene88
            character_kogoro "가와시마 씨의 등에는 진흙과 모래가 묻어 있습니다."
        
        if choice_state["door_1"] == False or choice_state["window_1"] == False: 
            scene black
            show scene92
            character_kogoro "이 문과 방 창문은 모두 잠겨 있습니다."
        
        if investigation_state["radio"] == False:
            scene black
            show scene80
            character_kogoro "녹음 테이프의 앞 부분이 몇 분간 공백으로 되어 있는 점으로 봐서.."

        scene black
        show scene104
        character_kogoro "종합해보면"

        scene black
        show scene99
        character_kogoro "아마도 범인은"

        show scene100
        character_kogoro "제사 도중에 가와시마 씨를 바다로 데리고 가 익사시켜서"

        show scene101
        character_kogoro "시체를 이 방으로 옮긴 뒤"
        
        show scene102
        character_kogoro "문을 잠그고 테이프 레코더의 스위치를 누른 뒤 복도로 나갔다라고 할 수 있지."
        
        show scene62
        character_kogoro "이 방 문이 잠겨 있었다면"
        character_kogoro "현관에는 계~속 우리가 있었으니"
        character_kogoro "범인은 제사 드리는 곳으로 돌아갔을 가능성이 높아."

    show scene105
    people "자, 잠깐만요!"
    people "범인이 아직 이 안에 있다는 거에요?"

    scene black
    show scene106:
        linear 4 xpos 1920-2831
    "(웅성웅성)"

    jump conan_start2